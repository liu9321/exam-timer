<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>è€ƒè©¦æº–å‚™ App</title>
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="è€ƒè©¦æº–å‚™">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIuiAg+ivleWHhuWCmyBBcHAiLAogICJzaG9ydF9uYW1lIjogIuiAg+ivlUFwcCIsCiAgImRlc2NyaXB0aW9uIjogIuW5tOW6leiAg+ivleWAkuaVuOiojOaZgiArIOeVquiMhOmQnyArIOaIkOWwseinmOmMhyIsCiAgInN0YXJ0X3VybCI6ICIvIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjNjY3ZWVhIiwKICAidGhlbWVfY29sb3IiOiAiIzY2N2VlYSIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1USTRJaUJvWldsbmFIUTlJakV5T0NJZ2RtbGxkMEp2ZUQwaU1DQXdJREV5T0NBeU9DSWdabWxzYkQwaUkySmpOMlZsWVNJK1BISmxZM1FnZUQwaU1UQWlJSGs5SWpFd0lpQjNhV1IwYUQwaU1UQTRJaUJvWldsbmFIUTlJakV3T0NJZ2NuZzlJalFpSUdacGJHdzlJaU5tWm1ZaUx6NDhkR1Y0ZENCNFBTSTJOQ0lnZVQwaU5UUWlJR1pwYkd3OUlpTXpNek1pSUdadmJuUXRjMmw2WlQwaU1qUWlQanh1Y21Ga1BpOHVhWE10WjJGd1Bqd3ZkR1Y0ZEQ0OEwzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjEyOHgxMjgiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            -webkit-user-select: none;
            user-select: none;
        }

        /* åº•éƒ¨å°èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-around;
            padding: 10px 0 max(10px, env(safe-area-inset-bottom));
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            min-width: 60px;
        }

        .nav-item.active {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }

        /* ä¸»è¦å…§å®¹å€ */
        .main-content {
            padding: max(20px, env(safe-area-inset-top)) 20px 100px 20px;
            max-width: 100vw;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .page-subtitle {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
        }

        /* å€’æ•¸è¨ˆæ™‚é é¢ */
        .exam-card {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            margin-bottom: 16px;
            box-shadow: 0 8px 24px rgba(255, 154, 158, 0.3);
        }

        .exam-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #444;
        }

        .exam-date {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-bottom: 16px;
            color: #666;
        }

        .countdown-display {
            font-size: 1.8rem;
            font-weight: bold;
            color: #d63384;
            font-family: -apple-system-monospaced, 'SF Mono', monospace;
        }

        /* ç•ªèŒ„é˜é é¢ */
        .timer-container {
            text-align: center;
        }

        .subject-selector {
            margin-bottom: 30px;
        }

        .subject-selector select {
            width: 100%;
            padding: 16px;
            border-radius: 12px;
            border: 2px solid #e1e8ed;
            font-size: 1rem;
            background: white;
            -webkit-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .timer-circle {
            width: 280px;
            height: 280px;
            margin: 0 auto 30px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }

        .timer-inner {
            width: 240px;
            height: 240px;
            background: white;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .timer-display {
            font-size: 3.5rem;
            font-weight: 300;
            color: #333;
            font-family: -apple-system-monospaced, 'SF Mono', monospace;
            margin-bottom: 8px;
        }

        .timer-status {
            font-size: 1rem;
            color: #666;
            font-weight: 500;
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 30px 0;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 28px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
            min-width: 90px;
            touch-action: manipulation;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            box-shadow: 0 4px 20px rgba(255, 107, 107, 0.3);
        }

        .btn.success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            box-shadow: 0 4px 20px rgba(81, 207, 102, 0.3);
        }

        /* æˆå°±é é¢ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(252, 182, 159, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #d35400;
            margin-bottom: 4px;
            font-family: -apple-system-monospaced, 'SF Mono', monospace;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #8b4513;
            font-weight: 500;
        }

        .progress-section {
            margin-bottom: 30px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-bar {
            background: #f8f9fa;
            border-radius: 20px;
            height: 12px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 20px;
        }

        .achievement-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .achievement-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            margin: 12px 0;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 16px;
            border-left: 4px solid #f39c12;
        }

        .achievement-icon {
            font-size: 2rem;
            min-width: 50px;
            text-align: center;
        }

        .achievement-text {
            flex: 1;
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 4px;
            color: #333;
        }

        .achievement-desc {
            font-size: 0.85rem;
            color: #666;
        }

        .achievement-date {
            font-size: 0.75rem;
            color: #999;
            text-align: right;
        }

        /* é€šçŸ¥ */
        .notification {
            position: fixed;
            top: max(20px, env(safe-area-inset-top));
            left: 20px;
            right: 20px;
            background: rgba(39, 174, 96, 0.95);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transform: translateY(-100px);
            transition: transform 0.3s ease;
            z-index: 2000;
            backdrop-filter: blur(20px);
        }

        .notification.show {
            transform: translateY(0);
        }

        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 380px) {
            .timer-circle {
                width: 240px;
                height: 240px;
            }
            
            .timer-inner {
                width: 200px;
                height: 200px;
            }
            
            .timer-display {
                font-size: 2.8rem;
            }
            
            .page-title {
                font-size: 1.6rem;
            }
        }

        /* iOS æ¨£å¼å„ªåŒ– */
        @supports (-webkit-touch-callout: none) {
            .bottom-nav {
                padding-bottom: calc(10px + env(safe-area-inset-bottom));
            }
        }

        /* æ·±è‰²æ¨¡å¼æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            .card {
                background: rgba(40, 44, 52, 0.95);
                color: #e6e6e6;
            }
            
            .bottom-nav {
                background: rgba(40, 44, 52, 0.95);
                border-top-color: rgba(255, 255, 255, 0.1);
            }
        }
    </style>
</head>
<body>
    <!-- ä¸»è¦å…§å®¹å€ -->
    <div class="main-content">
        <!-- å€’æ•¸è¨ˆæ™‚é é¢ -->
        <div id="countdown-page" class="page active">
            <div class="page-header">
                <h1 class="page-title">ğŸ“… è€ƒè©¦å€’æ•¸</h1>
                <p class="page-subtitle">è·é›¢ç›®æ¨™è¶Šä¾†è¶Šè¿‘äº†ï¼</p>
            </div>
            
            <div class="exam-card">
                <div class="exam-title">ç¶“æ¿Ÿéƒ¨åœ‹ç‡Ÿäº‹æ¥­è·å“¡è€ƒè©¦</div>
                <div class="exam-date">2025å¹´11æœˆ9æ—¥</div>
                <div class="countdown-display" id="countdown-1">è¨ˆç®—ä¸­...</div>
            </div>
            
            <div class="exam-card">
                <div class="exam-title">åœ°æ–¹ç‰¹è€ƒä¸‰ç­‰ç’°å¢ƒæª¢é©—é¡</div>
                <div class="exam-date">2025å¹´12æœˆ6æ—¥</div>
                <div class="countdown-display" id="countdown-2">è¨ˆç®—ä¸­...</div>
            </div>
            
            <div class="exam-card">
                <div class="exam-title">åˆè€ƒæœƒè¨ˆé¡è€ƒè©¦</div>
                <div class="exam-date">2026å¹´1æœˆ10æ—¥</div>
                <div class="countdown-display" id="countdown-3">è¨ˆç®—ä¸­...</div>
            </div>
        </div>

        <!-- ç•ªèŒ„é˜é é¢ -->
        <div id="timer-page" class="page">
            <div class="page-header">
                <h1 class="page-title">ğŸ… å°ˆæ³¨è¨ˆæ™‚</h1>
                <p class="page-subtitle">å°ˆæ³¨25åˆ†é˜ï¼Œä¼‘æ¯5åˆ†é˜</p>
            </div>
            
            <div class="card timer-container">
                <div class="subject-selector">
                    <select id="subject-select">
                        <option value="ç¶“æ¿Ÿéƒ¨åœ‹ç‡Ÿè€ƒè©¦">ç¶“æ¿Ÿéƒ¨åœ‹ç‡Ÿè€ƒè©¦</option>
                        <option value="ç’°å¢ƒæª¢é©—é¡è€ƒè©¦">ç’°å¢ƒæª¢é©—é¡è€ƒè©¦</option>
                        <option value="åˆè€ƒæœƒè¨ˆé¡è€ƒè©¦">åˆè€ƒæœƒè¨ˆé¡è€ƒè©¦</option>
                        <option value="ç¶œåˆè¤‡ç¿’">ç¶œåˆè¤‡ç¿’</option>
                    </select>
                </div>
                
                <div class="timer-circle">
                    <div class="timer-inner">
                        <div class="timer-display" id="timer-display">25:00</div>
                        <div class="timer-status" id="timer-status">æº–å‚™é–‹å§‹</div>
                    </div>
                </div>
                
                <div class="timer-controls">
                    <button class="btn success" id="start-btn">é–‹å§‹</button>
                    <button class="btn danger" id="pause-btn">æš«åœ</button>
                    <button class="btn" id="reset-btn">é‡ç½®</button>
                </div>
            </div>
        </div>

        <!-- æˆå°±é é¢ -->
        <div id="achievement-page" class="page">
            <div class="page-header">
                <h1 class="page-title">ğŸ† å­¸ç¿’æˆå°±</h1>
                <p class="page-subtitle">è¨˜éŒ„ä½ çš„æ¯ä¸€ä»½åŠªåŠ›</p>
            </div>
            
            <div class="card">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-sessions">0</div>
                        <div class="stat-label">å®Œæˆç•ªèŒ„é˜</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-hours">0</div>
                        <div class="stat-label">å­¸ç¿’æ™‚æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="streak-days">0</div>
                        <div class="stat-label">é€£çºŒå¤©æ•¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="daily-sessions">0</div>
                        <div class="stat-label">ä»Šæ—¥å®Œæˆ</div>
                    </div>
                </div>
                
                <div class="progress-section">
                    <div class="progress-header">
                        <span style="font-weight: 600;">ä»Šæ—¥é€²åº¦</span>
                        <span id="daily-progress-text">0/8 ç•ªèŒ„é˜</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="daily-progress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="achievement-list" id="achievement-list">
                    <div class="achievement-item">
                        <div class="achievement-icon">ğŸ¯</div>
                        <div class="achievement-text">
                            <div class="achievement-title">é–‹å§‹ä½ çš„å­¸ç¿’ä¹‹æ—…ï¼</div>
                            <div class="achievement-desc">å®Œæˆç¬¬ä¸€å€‹ç•ªèŒ„é˜ä¾†è§£é–æ›´å¤šæˆå°±</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆª -->
    <div class="bottom-nav">
        <div class="nav-item active" data-page="countdown-page">
            <div class="nav-icon">ğŸ“…</div>
            <div class="nav-label">å€’æ•¸</div>
        </div>
        <div class="nav-item" data-page="timer-page">
            <div class="nav-icon">ğŸ…</div>
            <div class="nav-label">å°ˆæ³¨</div>
        </div>
        <div class="nav-item" data-page="achievement-page">
            <div class="nav-icon">ğŸ†</div>
            <div class="nav-label">æˆå°±</div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification">
        ç•ªèŒ„é˜å®Œæˆï¼ä¼‘æ¯ä¸€ä¸‹å§ ğŸ‰
    </div>

    <script>
        // è¨»å†Š Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZXZlbnQgPT4ge30pOw==');
            });
        }

        // å…¨åŸŸè®Šæ•¸
        let timerInterval = null;
        let timeLeft = 25 * 60;
        let isRunning = false;
        let currentMode = 'work';
        let sessionCount = 0;

        // çµ±è¨ˆè³‡æ–™
        let stats = {
            totalSessions: 0,
            totalHours: 0,
            streakDays: 0,
            dailySessions: 0,
            lastStudyDate: null,
            achievements: []
        };

        // è€ƒè©¦æ—¥æœŸ
        const examDates = [
            new Date('2025-11-09'),
            new Date('2025-12-06'),
            new Date('2026-01-10')
        ];

        // é é¢å°èˆª
        function switchPage(pageId) {
            // éš±è—æ‰€æœ‰é é¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // é¡¯ç¤ºç›®æ¨™é é¢
            document.getElementById(pageId).classList.add('active');
            
            // æ›´æ–°å°èˆªç‹€æ…‹
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
        }

        // è¼‰å…¥å„²å­˜çš„è³‡æ–™
        function loadData() {
            const savedStats = localStorage.getItem('studyStats');
            if (savedStats) {
                stats = JSON.parse(savedStats);
                updateStatsDisplay();
                updateAchievements();
            }
            checkDailyReset();
        }

        // å„²å­˜è³‡æ–™
        function saveData() {
            localStorage.setItem('studyStats', JSON.stringify(stats));
        }

        // æª¢æŸ¥æ˜¯å¦éœ€è¦é‡ç½®æ¯æ—¥è³‡æ–™
        function checkDailyReset() {
            const today = new Date().toDateString();
            if (stats.lastStudyDate !== today) {
                stats.dailySessions = 0;
                updateDailyProgress();
                updateStatsDisplay();
            }
        }

        // æ›´æ–°å€’æ•¸è¨ˆæ™‚
        function updateCountdowns() {
            const now = new Date();
            
            examDates.forEach((examDate, index) => {
                const diff = examDate - now;
                const element = document.getElementById(`countdown-${index + 1}`);
                
                if (diff > 0) {
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                    
                    element.textContent = `${days}å¤© ${hours}æ™‚ ${minutes}åˆ†`;
                } else {
                    element.textContent = 'è€ƒè©¦å·²çµæŸ';
                    element.style.color = '#27ae60';
                }
            });
        }

        // æ›´æ–°è¨ˆæ™‚å™¨é¡¯ç¤º
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // é–‹å§‹è¨ˆæ™‚å™¨
        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                document.getElementById('timer-status').textContent = 
                    currentMode === 'work' ? 'å°ˆæ³¨ä¸­...' : 'ä¼‘æ¯ä¸­...';
                
                // é˜²æ­¢è¢å¹•ä¼‘çœ 
                if ('wakeLock' in navigator) {
                    navigator.wakeLock.request('screen').catch(() => {});
                }
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        completeSession();
                    }
                }, 1000);
            }
        }

        // æš«åœè¨ˆæ™‚å™¨
        function pauseTimer() {
            if (isRunning) {
                isRunning = false;
                clearInterval(timerInterval);
                document.getElementById('timer-status').textContent = 'å·²æš«åœ';
            }
        }

        // é‡ç½®è¨ˆæ™‚å™¨
        function resetTimer() {
            isRunning = false;
            clearInterval(timerInterval);
            timeLeft = currentMode === 'work' ? 25 * 60 : 5 * 60;
            updateTimerDisplay();
            document.getElementById('timer-status').textContent = 'æº–å‚™é–‹å§‹';
        }

        // å®Œæˆä¸€å€‹ç•ªèŒ„é˜
        function completeSession() {
            isRunning = false;
            clearInterval(timerInterval);
            
            // éœ‡å‹•æé†’
            if ('vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
            }
            
            if (currentMode === 'work') {
                // å®Œæˆå·¥ä½œç•ªèŒ„é˜
                sessionCount++;
                stats.totalSessions++;
                stats.totalHours += 0.42;
                stats.dailySessions++;
                stats.lastStudyDate = new Date().toDateString();
                
                showNotification('ç•ªèŒ„é˜å®Œæˆï¼ä¼‘æ¯ä¸€ä¸‹å§ ğŸ‰');
                
                // åˆ‡æ›åˆ°ä¼‘æ¯æ¨¡å¼
                currentMode = 'break';
                timeLeft = 5 * 60;
                document.getElementById('timer-status').textContent = 'ä¼‘æ¯æ™‚é–“ï¼';
                
                checkAchievements();
                updateStatsDisplay();
                updateDailyProgress();
                saveData();
            } else {
                // å®Œæˆä¼‘æ¯
                showNotification('ä¼‘æ¯çµæŸï¼æº–å‚™ä¸‹ä¸€å€‹ç•ªèŒ„é˜ ğŸ’ª');
                currentMode = 'work';
                timeLeft = 25 * 60;
                document.getElementById('timer-status').textContent = 'æº–å‚™é–‹å§‹';
            }
            
            updateTimerDisplay();
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            // ç³»çµ±é€šçŸ¥
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('è€ƒè©¦æº–å‚™ App', {
                    body: message,
                    icon: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAyOCIgZmlsbD0iIzY2N2VlYSI+PHJlY3QgeD0iMTAiIHk9IjEwIiB3aWR0aD0iMTA4IiBoZWlnaHQ9IjEwOCIgcng9IjQiIGZpbGw9IiNmZmYiLz48dGV4dCB4PSI2NCIgeT0iNTQiIGZpbGw9IiMzMzMiIGZvbnQtc2l6ZT0iMjQiPjxucmFkPi48L3RleHQ+PC9zdmc+'
                });
            }
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // æ›´æ–°çµ±è¨ˆé¡¯ç¤º
        function updateStatsDisplay() {
            document.getElementById('total-sessions').textContent = stats.totalSessions;
            document.getElementById('total-hours').textContent = Math.round(stats.totalHours);
            document.getElementById('streak-days').textContent = calculateStreak();
            document.getElementById('daily-sessions').textContent = stats.dailySessions;
        }

        // æ›´æ–°æ¯æ—¥é€²åº¦
        function updateDailyProgress() {
            const dailyGoal = 8;
            const progress = (stats.dailySessions / dailyGoal) * 100;
            
            document.getElementById('daily-progress').style.width = `${Math.min(progress, 100)}%`;
            document.getElementById('daily-progress-text').textContent = `${stats.dailySessions}/${dailyGoal} ç•ªèŒ„é˜`;
        }

        // è¨ˆç®—é€£çºŒå­¸ç¿’å¤©æ•¸
        function calculateStreak() {
            const today = new Date().toDateString();
            return stats.lastStudyDate === today ? 1 : 0;
        }

        // æª¢æŸ¥æˆå°±
        function checkAchievements() {
            const achievements = [
                { id: 'first', condition: () => stats.totalSessions >= 1, 
                  text: 'é¦–æ¬¡å®Œæˆï¼', desc: 'å®Œæˆäº†ç¬¬ä¸€å€‹ç•ªèŒ„é˜', icon: 'ğŸ¯' },
                { id: 'five', condition: () => stats.totalSessions >= 5, 
                  text: 'åˆéœ²é‹’èŠ’', desc: 'å®Œæˆ5å€‹ç•ªèŒ„é˜', icon: 'â­' },
                { id: 'twenty', condition: () => stats.totalSessions >= 20, 
                  text: 'å­¸ç¿’é”äºº', desc: 'å®Œæˆ20å€‹ç•ªèŒ„é˜', icon: 'ğŸ†' },
                { id: 'fifty', condition: () => stats.totalSessions >= 50, 
                  text: 'å°ˆæ³¨å¤§å¸«', desc: 'å®Œæˆ50å€‹ç•ªèŒ„é˜', icon: 'ğŸ‘‘' },
                { id: 'hundred', condition: () => stats.totalSessions >= 100, 
                  text: 'ç™¾éŠæˆé‹¼', desc: 'å®Œæˆ100å€‹ç•ªèŒ„é˜', icon: 'ğŸ’' },
                { id: 'daily8', condition: () => stats.dailySessions >= 8, 
                  text: 'æ—¥è¡Œå…«å–„', desc: 'å–®æ—¥å®Œæˆ8å€‹ç•ªèŒ„é˜', icon: 'ğŸ”¥' },
                { id: 'hours10', condition: () => stats.totalHours >= 10, 
                  text: 'åå°æ™‚å‹‡å£«', desc: 'ç´¯è¨ˆå­¸ç¿’10å°æ™‚', icon: 'ğŸ’ª' },
                { id: 'hours50', condition: () => stats.totalHours >= 50, 
                  text: 'å­¸ç¿’é¦¬æ‹‰æ¾', desc: 'ç´¯è¨ˆå­¸ç¿’50å°æ™‚', icon: 'ğŸƒâ€â™‚ï¸' },
            ];

            achievements.forEach(achievement => {
                if (achievement.condition() && !stats.achievements.includes(achievement.id)) {
                    stats.achievements.push(achievement.id);
                    addAchievementToList(achievement);
                    showNotification(`ğŸ‰ ç²å¾—æˆå°±ï¼š${achievement.text}ï¼`);
                }
            });
        }

        // æ·»åŠ æˆå°±åˆ°åˆ—è¡¨
        function addAchievementToList(achievement) {
            const list = document.getElementById('achievement-list');
            const item = document.createElement('div');
            item.className = 'achievement-item';
            item.innerHTML = `
                <div class="achievement-icon">${achievement.icon}</div>
                <div class="achievement-text">
                    <div class="achievement-title">${achievement.text}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                </div>
                <div class="achievement-date">${new Date().toLocaleDateString()}</div>
            `;
            
            // æ·»åŠ å‹•ç•«æ•ˆæœ
            item.style.transform = 'translateX(100%)';
            item.style.opacity = '0';
            list.insertBefore(item, list.firstChild);
            
            setTimeout(() => {
                item.style.transition = 'all 0.3s ease';
                item.style.transform = 'translateX(0)';
                item.style.opacity = '1';
            }, 10);
        }

        // æ›´æ–°æ‰€æœ‰æˆå°±é¡¯ç¤º
        function updateAchievements() {
            const list = document.getElementById('achievement-list');
            
            if (stats.achievements.length === 0) {
                list.innerHTML = `
                    <div class="achievement-item">
                        <div class="achievement-icon">ğŸ¯</div>
                        <div class="achievement-text">
                            <div class="achievement-title">é–‹å§‹ä½ çš„å­¸ç¿’ä¹‹æ—…ï¼</div>
                            <div class="achievement-desc">å®Œæˆç¬¬ä¸€å€‹ç•ªèŒ„é˜ä¾†è§£é–æ›´å¤šæˆå°±</div>
                        </div>
                    </div>
                `;
            } else {
                // é‡æ–°æ§‹å»ºæˆå°±åˆ—è¡¨
                const achievements = [
                    { id: 'first', text: 'é¦–æ¬¡å®Œæˆï¼', desc: 'å®Œæˆäº†ç¬¬ä¸€å€‹ç•ªèŒ„é˜', icon: 'ğŸ¯' },
                    { id: 'five', text: 'åˆéœ²é‹’èŠ’', desc: 'å®Œæˆ5å€‹ç•ªèŒ„é˜', icon: 'â­' },
                    { id: 'twenty', text: 'å­¸ç¿’é”äºº', desc: 'å®Œæˆ20å€‹ç•ªèŒ„é˜', icon: 'ğŸ†' },
                    { id: 'fifty', text: 'å°ˆæ³¨å¤§å¸«', desc: 'å®Œæˆ50å€‹ç•ªèŒ„é˜', icon: 'ğŸ‘‘' },
                    { id: 'hundred', text: 'ç™¾éŠæˆé‹¼', desc: 'å®Œæˆ100å€‹ç•ªèŒ„é˜', icon: 'ğŸ’' },
                    { id: 'daily8', text: 'æ—¥è¡Œå…«å–„', desc: 'å–®æ—¥å®Œæˆ8å€‹ç•ªèŒ„é˜', icon: 'ğŸ”¥' },
                    { id: 'hours10', text: 'åå°æ™‚å‹‡å£«', desc: 'ç´¯è¨ˆå­¸ç¿’10å°æ™‚', icon: 'ğŸ’ª' },
                    { id: 'hours50', text: 'å­¸ç¿’é¦¬æ‹‰æ¾', desc: 'ç´¯è¨ˆå­¸ç¿’50å°æ™‚', icon: 'ğŸƒâ€â™‚ï¸' }
                ];
                
                list.innerHTML = '';
                achievements.forEach(achievement => {
                    if (stats.achievements.includes(achievement.id)) {
                        const item = document.createElement('div');
                        item.className = 'achievement-item';
                        item.innerHTML = `
                            <div class="achievement-icon">${achievement.icon}</div>
                            <div class="achievement-text">
                                <div class="achievement-title">${achievement.text}</div>
                                <div class="achievement-desc">${achievement.desc}</div>
                            </div>
                            <div class="achievement-date">å·²ç²å¾—</div>
                        `;
                        list.appendChild(item);
                    }
                });
                
                if (list.children.length === 0) {
                    list.innerHTML = `
                        <div class="achievement-item">
                            <div class="achievement-icon">ğŸ¯</div>
                            <div class="achievement-text">
                                <div class="achievement-title">é–‹å§‹ä½ çš„å­¸ç¿’ä¹‹æ—…ï¼</div>
                                <div class="achievement-desc">å®Œæˆç¬¬ä¸€å€‹ç•ªèŒ„é˜ä¾†è§£é–æ›´å¤šæˆå°±</div>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // åˆå§‹åŒ–äº‹ä»¶ç›£è½
        function initEventListeners() {
            // åº•éƒ¨å°èˆªé»æ“Šäº‹ä»¶
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const pageId = item.dataset.page;
                    switchPage(pageId);
                });
            });

            // ç•ªèŒ„é˜æ§åˆ¶æŒ‰éˆ•
            document.getElementById('start-btn').addEventListener('click', startTimer);
            document.getElementById('pause-btn').addEventListener('click', pauseTimer);
            document.getElementById('reset-btn').addEventListener('click', resetTimer);

            // è«‹æ±‚é€šçŸ¥æ¬Šé™
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // é˜²æ­¢ä¸‹æ‹‰åˆ·æ–°
            document.addEventListener('touchmove', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                }
            }, { passive: false });

            let lastTouchEnd = 0;
            document.addEventListener('touchend', function(e) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    e.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        function initApp() {
            loadData();
            updateTimerDisplay();
            updateCountdowns();
            updateDailyProgress();
            initEventListeners();
            
            // æ¯ç§’æ›´æ–°å€’æ•¸è¨ˆæ™‚
            setInterval(updateCountdowns, 1000);
            
            // æ¯åˆ†é˜æª¢æŸ¥æ—¥æœŸé‡ç½®
            setInterval(checkDailyReset, 60000);
        }

        // ç•¶é é¢è¼‰å…¥å®Œæˆæ™‚åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        // PWA å®‰è£æç¤º
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // é¡¯ç¤ºå®‰è£æç¤ºï¼ˆå¯ä»¥æ·»åŠ è‡ªå®šç¾©çš„å®‰è£æŒ‰éˆ•ï¼‰
            setTimeout(() => {
                if (confirm('æ˜¯å¦è¦å°‡æ­¤ App å®‰è£åˆ°æ‚¨çš„æ‰‹æ©Ÿæ¡Œé¢ï¼Ÿ')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        deferredPrompt = null;
                    });
                }
            }, 5000);
        });

        // è™•ç† iOS çš„å®‰è£æç¤º
        if (/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream) {
            window.addEventListener('load', () => {
                if (!window.navigator.standalone) {
                    setTimeout(() => {
                        if (confirm('åœ¨ Safari ä¸­é»æ“Šåˆ†äº«æŒ‰éˆ•ï¼Œç„¶å¾Œé¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€ä¾†å®‰è£æ­¤ Appï¼')) {
                            // å¯ä»¥é¡¯ç¤ºæ›´è©³ç´°çš„å®‰è£èªªæ˜
                        }
                    }, 3000);
                }
            });
        }
    </script>
</body>
</html>